# 보안

- 프롬프트는 명령, 시스템 구성, 권한 위임, 의사결정 로직이 프롬프트에 담겨 있기 때문에, 이 모든 건 소프트웨어 보안 수준의 감시와 방어가 필요합니다.

```
┌───────────────────────────────┐
│         [입력 프롬프트]     
│     사용자 질문 / 지시 입력       
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│         [입력단 전처리]          
│ - "이전 지시 무시" 탐지         
│ - 비속어 / 인젝션 키워드 필터링 
│ - 입력 길이 제한               
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│      [시스템 프롬프트 보호]     
│ - 시스템/사용자 프롬프트 분리   
│ - 시스템 지시 우선권 고정       
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│         [출력단 검열]           
│ - 민감 정보(경로, 이름 등) 검출 
│ - 금지어 마스킹 / 응답 차단     
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│        [세션/로그 관리]         
│ - 세션 분리 → 사용자 간 정보 차단 
│ - 로그 비식별화 (이름, 이메일 제거)
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│          [보안 테스트]  
│ - 역방향 프롬프트 작성 → 우회 시도 
│ - 취약점 발견 시 방어 로직 개선   
└───────────────────────────────┘
```

## 분류

| 방어 단계 | 전략 | 설명 |
| --- | --- | --- |
| 입력 | 시스템/사용자 분리 | 시스템 프롬프트 고정, 덮어쓰기 방지 |
| 입력 | 프롬프트 전처리 | "이전 지시 무시…" 등의 명령 감지 및 필터링 |
| 출력 | 민감어 검열 | 출력값 중 민감 정보 존재 시 후처리 |
| 시스템 | 세션 분리 | 사용자 간 맥락 공유 방지 |
| 로그 | 비식별화 | 개인정보 마스킹, 기록 분리 저장 |

## 입력단 방어

- 시스템 프롬프트/사용자 입력 분리 
    - 시스템 프롬프트의 우선순위가 더 높게 책정될 수 있도록 사용자의 입력과 시스템 프롬프트(ChatGPT → ChatGPT 맞춤 설정)를 명확히 구분해야 합니다. 
- 입력 프롬프트 전처리
    - 사용자 입력 길이 제한, 맥락 분석을 강화하여 "이전 지침을 무시하라"는 식의 명령이 있다면 거부하는 등의 정제가 필요합니다.
    - 사용자의 입력이 외부 콘텐츠일 경우 프롬프트를 전처리하여 필터링합니다.

## 출력단 방어

- 응답 후처리
    - 프롬프트의 응답을 바로 출력하지 않고 내부적으로 후처리하여 민감한 정보가 포함되었는지 다시 검증하여 정제합니다.
- 개인정보 마스킹
    - 훈련 데이터 내 포함된 개인정보가 노출 될 가능성이 있기 때문에 개인정보 데이터의 경우 주요 정보에 "*"로 대체 처리하거나 지워버리는 정제 작업이 필요합니다.

## 세션/로그 관리

> 대화에는 개인정보가 포함될 수 있기 때문에 민감한데, 최근 서비스에는 대화를 개별 세션으로 처리하고 있으나, 과거에는 이전 사용자의 질의/응답 대화 정보가 다른 사용자에게 유출되는 경우가 있었습니다.

- 세션 관리 
    - 각 대화가 독립적이고 과거의 입력과 연관되지 않도록 세션 관리가 중요합니다.    
- 로그 관리 및 비식별화 
    - 프롬프트 테스트 과정에서 질의/응답/대화 데이터를 로그로 남기는 경우 모델의 접근 권한에 따라 노출될 수 있습니다. 프롬프트의 로그를 관리할 때는 정보 요청/출력을 서로 다른 권한 수준으로 설정하세요. 
    - 생년월일, 주민등록번호, 이메일과 같은 식별 가능한 정보를 삭제하거나 마스킹하고 일반화 하는 등 비식별화 처리해야 합니다.

## 보안 테스트

- 역방향 프롬프트 엔지니어링(Reverse Prompt Engineering)
    - 시스템 프롬프트가 유출되거나 정책에 맞지 않는 답변을 하는가와 같은 문제 상황을 테스트하는 것입니다.
    - 공격자의 관점에서 프롬프트를 작성해보고, 시스템이 얼마나 쉽게 우회되는지 프롬프트 테스트 시나리오를 구성할 수 있습니다.
    - 개인정보 등의 민감한 정보가 포함된 답변을 보고, 공격 프롬프트를 역으로 유추하여 보안 취약점을 검토합니다.

## 정리

| 항목 | 설명 | 예시 |
| --- | --- | --- |
| 정의 | 프롬프트에 담긴 권한·로직·구성이 외부에 노출되지 않도록 보호하는 것 | 프롬프트 인젝션 방어, 민감 정보 검열 |
| 주요 사고 유형 | 프롬프트 인젝션, 민감 정보 노출, 세션 공유 위험 | "이전 지시 무시…" 공격, 개인정보 출력 |
| 방어 단계 | 입력단, 출력단, 시스템단, 로그 관리로 나눠 방어 | 입력 필터링, 민감어 검열, 세션 분리, 로그 비식별화 |
| 입력단 전략 | 시스템/사용자 프롬프트 분리, "지시 무시" 감지 및 차단 | ChatGPT 맞춤 설정 → 시스템 지시 고정 |
| 출력단 전략 | 응답 후처리, 민감어 마스킹 | "홍길동" → "***" 처리 |
| 세션/로그 관리 | 세션 간 맥락 공유 방지, 로그 비식별화 | 고객상담 대화 기록에서 생년월일, 이름 삭제 |
| 보안 테스트 | 역방향 프롬프트 엔지니어링(Reverse Prompt Engineering) | 공격 시나리오 작성 후 시스템이 우회되는지 테스트 |

## 요약

- 프롬프트 보안은 인젝션 공격, 민감 정보 유출, 세션 공유 등의 사고를 막기 위한 전략입니다.
- 입력단, 출력단, 시스템단, 로그 관리까지 단계별 방어 전략이 필요합니다.
- 역방향 프롬프트 엔지니어링을 통해 사전에 취약점을 점검하고 대응할 수 있습니다.

## 생각해보기

- 시스템 프롬프트와 사용자 프롬프트를 분리하지 않으면 어떤 문제가 생길 수 있을까요?
- 출력단 검열이 없다면 어떤 문제가 생길 수 있을까요?
- 출력 결과에 민감 정보가 포함될 수 있는 이유는 무엇인가요?
- 보안 테스트(역방향 프롬프트 엔지니어링)는 어떤 절차로 진행해야 할까요?
- 세션 분리와 로그 비식별화는 각각 어떤 위험을 방지하기 위한 것인가요?
