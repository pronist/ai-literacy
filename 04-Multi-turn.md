# 멀티턴

> 턴(Turn)은 대화형 AI 서비스에 질의/응답으로 구성되는 하나의 단위인데, 멀티턴(Multi-turn)은 한 세트만으로 구성되는 싱글턴(Single-turn)과는 다르게 턴이 여러 번 반복되는 대화 방식을 의미합니다.

## 개요

- 멀티턴에서는 한 번에 이야기하기에는 주제가 많은 내용에 대해 프로그레시브 프롬프팅(Progressive Prompting)을 통해 여러 턴을 거쳐 단계별로 수행하도록 만드는 전략을 구사할 수 있습니다.

## 멀티턴을 사용하면 좋을 때

- [ ] 요청이 너무 길고 복잡하다
- [ ] 한 번에 다 물어보면 대답이 두루뭉술하거나 과적재된다
- [ ] 단계별 피드백(검토 → 수정 → 다음 단계)이 필요하다
- [ ] 사용자 선택 또는 결정이 필요한 구간이 있다
- [ ] 문맥이 흐트러질 수 있는 긴 대화다
- [ ] 과정 중간에 결과를 보고 방향을 조정해야 한다

## vs 싱글턴

| 항목 | 싱글턴 | 멀티턴 |
| --- | --- | --- |
| 요청 | 한 문장에 모든 요청 포함 | 단계별로 나눔 |
| 응답 | 한 번에 전부 생성 | 응답 → 확인 → 다음 단계 |
| 위험 | 과적재, 맥락 누락 | 흐름 지연, 컨텍스트 단절 가능 |
| 활용 | 단순 응답, FAQ | 기획, 설계, 문서화 등 |

## 위험요소 대응 전략

- 과도한 세분화는 지연을 부르고, 문맥 단절은 맥락 주입으로 해결합니다.

| 리스크 | 원인 | 대응 방법 |
|--------|------|------------|
| 흐름 지연 | 과도한 세분화 | 핵심 주제 우선순위 조정 |
| 문맥 단절 | 컨텍스트 윈도우 한계 | 맥락 주입 활용 |
| 사용자 피드백 누락 | '좋아요, 다음' 생략 | 응답 전 "다음으로 진행할까요?" 유도 |

## 프로그레시브 프롬프팅

- 프로그레시브 프롬프팅(Progressive Prompting)은 복잡한 요청을 한꺼번에 처리하지 않고 순차적으로 쪼개어 단계별로 진행하는 프롬프트 전략입니다.
- 탑다운, ReAct 과 같은 전략과 호환이 가능하며, CoT, 프롬프트 체이닝 같은 단계별 추론 전략을 멀티턴으로 분리한 것이라고 볼 수도 있습니다. 
- 독립되어 있지만 연관된 주제에 대해 한꺼번에 처리하면 정확도가 떨어질 수도 있기 때문에 멀티턴으로 순차적으로 처리하여 모델이 하나의 주제에 몰입하여 독립적으로 사고할 수 있도록 유도합니다.
- 한 가지 주제에 대해 수직적/수평적으로 확장할 수 있으므로 콘텐츠 기획에서 새로운 아이디어를 창출하거나 소설과 같이 스토리가 이어지는 창작에서 유용할 수 있습니다.

### 예시

> 실제 교안 평가에 사용된 프롬프트입니다.

```
- 당신은 AI 교육 전문가입니다.

# 지시

'AI 리터러시'에 사용될 교안을 처음부터 [목차]에 따라 순차적으로 **턴 당** 하나씩 처리하고, 각 교안에 대해서는 [절차]를 따르세요.

# 절차

1. 각 [기준]을 개별적으로 평가(아주 나쁨, 나쁨, 보통, 좋음, 아주 좋음)하세요.
2. 최종적으로 해당 교안에 대해 판정(완성/미완성)을 내리세요.

# 목차

01. 프롬프트 엔지니어링
    - [프롬프트 엔지니어링 개요](01-Overview.md)
    - [기본 요소](02-Basics.md)
    - [추론 전략](03-Strategies.md)
    - [멀티턴](04-Multi-turn.md)
    - [프롬프트 테스트](05-Testing.md)
02. 보안
    - [해킹](06-Hacking.md)
    - [보안](07-Security.md)
03. 프롬프트 확장
    - [개인화 메모리](08-Memory.md)
    - [RAG](09-RAG.md)
    - [코드 기반 프롬프트](10-Code-based.md)
    - [멀티모달](11-Multimodal.md)
03. 자동화
    - [AI 오케스트레이션](12-Orchestration.md)
    - [멀티에이전트](18-Multi-agent.md)
04. 언어모델
    - [학습](19-Learning.md)
    - [파인튜닝](20-Fine-tuning.md)
    - [토크나이저](21-Tokenizer.md)
    - [트랜스포머](22-Transformer.md)
    - [BERT](23-BERT.md)
    - [어텐션](24-Attention.md)
    - [샘플링 전략](25-Sampling.md)

# 기준

- 정확성: 기술적 서술과 시각화 자료는 정확한 내용이어야 합니다. (단, 값 계산의 경우에는 '예시'일 뿐이므로 수학적으로 정확하지 않아도 괜찮습니다.)
- 충실성: 각 챕터와 하위 챕터에 대한 내용이 모자람없이 담겨있어야 합니다.
- 직관성: 시각화 자료(표, 다이어그램 등)를 포함하고, 학습자가 볼 때 한눈에 알 수 있도록 정리되어 있어야 합니다.
- 간결성: 책에 쓰일 내용이 아니므로 개념이 명확하고 간결하게 설명되어야 합니다.
- 연결성: 각 교안의 내용은 '이전에 배운' 내용(교안 ↔ 교안, 또는 각 교안 내부의 주제 ↔ 주제)과 자연스럽게 학습 흐름이 구성되어야 합니다.
- 맞춤화: '비전문가 대상' 이라는 목적에 분명하도록 기술적이거나 너무 어렵게 서술되어 있으면 안됩니다.
- 비동기: 수강생들은 '비동기 강의'와 함께 교안을 보면서 참고할 수 있다는 것을 가정하여 구성되어 있어야 합니다.
```

## 맥락 주입

- 채팅 세션이 너무 길어져서 '컨텍스트 윈도우를 벗어난 경우' 모델은 이전 대화를 생략하거나 무시합니다. 
- 맥락 주입(Context Injection)은 컨텍스트 윈도우를 벗어나기 전에, 이전 대화의 내용을 명시적으로 요약해서 다시 제공하고 언어모델이 다시 과거의 내용을 다시 상기시키도록 유도하는 전략입니다.

### 이전 대화

```
다음 질문을 하기 전에 지금까지의 내용을 요약해 정리하세요
```

### 맥락 명시

```
# 상황

우리는 지금까지 '비전문가 대상의 프롬프트 엔지니어링 강의 교안'을 만들고 있었습니다. 

# 지시

[맥락]을 유지해서 다음 질문에 답해주세요

# 맥락

- 목표는 비개발자도 이해할 수 있는 수준
- 주요 챕터는 프롬프트 기본 요소, 추론 전략, 테스트, 보안 등
- 실습 키트, 예시, 시각화, 평가 기준 등을 포함
- 트랜스포머, BERT, 멀티모달 모델 등의 이해도 필요
- 당신은 살짝 삐딱하지만 유능한 보조자 역할
```

## 정리

| 항목 | 설명 | 예시 |
| --- | --- | --- |
| 정의 | AI와 여러 턴(turn)의 대화를 통해 단계적으로 작업 수행 | 설계 → 검토 → 수정 → 완성까지 여러 차례 대화 |
| 적합한 상황 | 복잡한 요청, 단계별 피드백, 사용자 선택이 필요한 경우 | 긴 문서 요약, 보고서 작성, 설계 피드백 |
| 주요 전략 | 프로그레시브 프롬프팅 (Progressive Prompting) 사용 | "1단계: 아이디어 목록 → 2단계: 우선순위 지정…" |
| vs 싱글턴 | 한 번에 질문·답변 → 과적재 위험 | 멀티턴은 흐름 유지, 단계별 확인 가능 |
| 위험요소 | 과도한 세분화로 지연, 컨텍스트 단절 | 대응: 맥락 주입, 사용자 피드백 유도 |
| 대응 방법 | 문맥 유지: 맥락 주입 활용 | "지금까지 논의한 내용을 요약해보면…" |
| 활용 예시 | 기획안 작성, 디자인 검토, 교육 과정 설계 | "각 주차별 학습 목표 설계 → 활동 아이디어 수집 → 검토" |
| 맥락 주입 | 컨텍스트 윈도우 한계 시 이전 대화 요약·재삽입 | "지금까지 논의된 내용을 요약해봅시다…" |

## 요약

- 멀티턴은 복잡한 요청을 단계적으로 나눠 정확하고 일관된 결과를 얻는 전략입니다.
- 프로그레시브 프롬프팅을 통해 세부 작업을 나누고, 단계별 피드백과 수정이 가능합니다.
- 문맥 단절을 막기 위해 맥락 주입을 함께 사용하는 것이 좋습니다.

## 생각해보기

- 멀티턴이 싱글턴보다 유리한 작업은 어떤 특징을 가지고 있나요?
- 멀티턴에서 컨텍스트(문맥)가 단절될 위험은 어떤 경우에 발생할까요? 이를 방지하려면?
- 프로그레시브 프롬프팅을 효과적으로 설계하기 위해 어떤 점을 고려해야 할까요?
- 멀티턴 전략을 실무에 적용한 사례가 있다면 무엇이 있을까요?
