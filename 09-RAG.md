# 검색 증강 생성

- 검색 증강 생성(RAG; Retrieval-Augmented Generation)은 사전에 학습된 데이터가 아니라 외부의 리소스(웹, 데이터베이스, 파일)에서 실시간으로 자료를 얻어와 프롬프트의 맥락(Context)으로 첨부되어 사용자의 프롬프트를 보강해주는 기술입니다.

> RAG를 사용하면 입력 프롬프트에 컨텍스트가 첨부되기 때문에 환각(Hallucination) 현상을 줄일 수 있습니다.

## 원리

- 사용자의 입력 프롬프트가 주어지면 먼저 데이터베이스에서 정보를 검색하고, 그 정보를 프롬프트로 첨부하여 프롬프트를 보강합니다.

> ChatGPT에서 '웹검색'을 통해 외부 지식을 가져와 프롬프트에 맥락으로 추가할 수도 있습니다.

```
┌───────────────────────────────┐
│         [입력 프롬프트]
│    "우리 회사 연차 규정 알려줘" 
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│             [검색] 
│ 데이터베이스에서 유사한 문서 검색   
│ 예: "연차 규정.docx"          
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│      [관련 문서 텍스트 추출]
│ "연차는 연 15일 부여되며..." 
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│      [프롬프트 확장 / 보강]       
│ 원래 프롬프트 + 문서 내용      
│ → "우리 회사 연차 규정 알려줘 
│     (참고: 연차는 연 15일...)"
└───────────────────────────────┘
```

## 지식 기반 검색

- 파일을 업로드하면 별도의 기술적 조치 없이도 파일에 있는 내용을 바탕으로 시스템이 파일을 읽고 프롬프트에 맥락(Context)으로 첨부하여 사용자의 질문에 대답합니다. 
- 업로드한 파일에서 관련 정보를 즉시 찾아내어 활용하는 방식이므로 빠르게 지식 기반(Knowledge base) 질문에 대응할 수 있습니다.
- 사용자는 파일만 업로드하면 되므로, 구성 비용이나 복잡도가 낮습니다.
- 오픈북 시험을 볼 때, 책에서 필요한 정보를 바로 찾아서 답변하는 것과 같습니다.
- 벡터 데이터베이스를 사용하는 전통적인 RAG 시스템이라고는 볼 수 없지만, 'RAG-like'로써 RAG와 유사하게 동작합니다.
- ChatGPT에서는 업로드된 문서를 자동으로 검색 가능하게 만들지만, 이는 OpenAI가 백엔드에서 자동화한 RAG-like 구조 덕분입니다.

> ChatGPT 채팅 → 파일 업로드, ChatGPT 프로젝트, [Custom GPTs](12-Orchestration.md)에서 파일을 직접 업로드하고 실습해볼 수 있습니다.

### 주의할 점

- 버전이 여러 개인 경우, 혼선이 생길 수 있습니다.
- 파일이 최신화 되어 있지 않은 경우 과거의 내용을 대답할 수도 있습니다.
- 문서가 너무 길 경우 자르기 전략이 필요합니다.
- 저장된 내용이 너무 많으면 불필요한 문서가 검색될 수 있습니다.

### 예시

- 내부 보고서 요약 → Notion 문서 → 인사이트 생성
- 고객지원 챗봇 → 사내 FAQ + 제품 매뉴얼 검색 → 답변 생성
- 의료 문서 요약 → 논문 검색 → 내용 기반 정리

## 벡터 데이터베이스

- 벡터 데이터베이스(Vector Database)는 문서나 정보를 모델이 이해할 수 있는 숫자 표현인 벡터(Vector)로 바꿔 저장해두는 저장소입니다.
- 내부 정보를 저장하고 자연어 프롬프트로 검색하고 싶은 경우 사용합니다. 
- "우리 회사의 정책을 알려줘"라고 물었을 때, 벡터 서치(Vector Search)를 통해 관련 문서를 찾아와 그 내용을 프롬프트에 보강합니다.

### vs 지식 기반 검색

- 지식 기반은 빠르고 단순하지만 규모에 한계가 있고, 벡터 데이터베이스는 확장성과 유연성에서 유리합니다.

| 항목 | 지식 | 벡터 데이터베이스 |
| --- | --- | --- |
| 목적 | 업로드된 문서에서 실시간 추출 | 대규모 비정형 자료 검색 |
| 구조 | 단순 파일 참조 | 벡터화된 문서 검색 |
| 준비 | 파일 업로드만 필요 | 벡터화 + 데이터베이스 구축 |
| 비용/속도 | 낮음, 빠름 | 초기 구축 비용 있으나 효율적 |
| 업데이트 | 파일 교체 | 문서 갱신 필요 |
| 유연성 | 단일 문서 기반 | 유사도 검색 + 스케일 확장 가능 |
| 활용 사례 | 내부 규정 조회, 즉답형 | 사내 지식 검색, 문서 요약, 고객 응대 |

## 팁

| 항목 | 설명 | 예시 / 권장 방식 |
| --- | --- | --- |
| 검색 결과 요약 | 원문 그대로 복붙하지 말고, 핵심 정보로 요약/정리 | → "문서에서 핵심 내용을 요약해 넣기" |
| 출처 명시 | 어떤 문서/소스에서 나온 정보인지 구분 | → `[Doc1]`, `[내부지침]`, `(FAQ 발췌)` 등 |
| 응답 범위 제한 | 검색 기반 응답임을 명시하여 환각 방지 | → "다음 문서를 기반으로만 답하세요" |
| 무응답 처리 | 검색 결과가 없을 경우 응답 전략 명시 | → "해당 정보를 찾을 수 없습니다" |

## vs 일반 프롬프트

| 항목 | 일반 프롬프트 | RAG |
| --- | --- | --- |
| 입력 | 질문만 입력 | 질문 + 외부 문서 검색 결과 포함 |
| 지식 출처 | 모델의 사전학습 | 외부 문서 기반 |
| 환각 가능성 | 높음 | 낮음 |
| 예시 | "연차 규정 알려줘" → 추론 기반 응답 | "(참고: 연차는 연 15일...)" 포함 응답 |

## 그라운딩

- 그라운딩(Grounding)은 모델이 생성하는 텍스트가 실제 현실, 데이터, 문서 등과 일치하도록 웹이나 백과사전 등의 '사실적 출처(Real-world sources)'을 참조하거나 연결하는 과정입니다. 
- ChatGPT의 '웹검색'은 모델이 답변을 생성하기 위해 '웹'이라는 외부 리소스에서 정보를 참조하는 그라운딩 방식의 일종이라고 볼 수 있습니다. 
- 모델이 단순히 기억이나 학습된 지식만 사용하는 게 아니라, 현실 정보에 기반해서 답을 생성하는 것이므로, 이런 경우는 "모델의 응답이 외부 정보에 기반하여 그라운딩되었다"고 말할 수 있습니다. 
- 사전 학습된 데이터가 아닌 외부 리소스의 데이터를 근거로 대답할 수 있도록 하여 단순 추론보다 신뢰도가 높고 환각을 줄여줍니다.

### 전략

| 방식 | 설명 | 예시 |
| --- | --- | --- |
| 웹검색 | 인터넷에서 실시간 정보 검색 | 최신 뉴스, 가격 정보 등 |
| RAG(Retrieval-Augmented Generation) | 사전에 구축한 문서 DB에서 정보 검색 후 생성 | 회사 내부 매뉴얼 기반 응답 |
| 도구 호출 | SQL 쿼리, 날짜 계산, API 호출 등을 이용한 응답 | 수학 문제 풀이, 코드 실행 결과 |
| 센서 데이터/IoT | 실제 환경에서 수집한 데이터 반영 | 온도 센서 기반 응답 등 |

## 정리

| 항목 | 설명 | 예시 |
| --- | --- | --- |
| 정의 | 외부 지식(문서, 파일, 데이터베이스)을 검색해 프롬프트에 보강하는 방식 | "우리 회사 연차 규정 알려줘" → 연차.docx 검색 → 답변 생성 |
| 목적 | 모델 자체 지식에 의존하지 않고 실시간 정보 활용, 환각(Hallucination) 감소 | 내부 정책, 최신 뉴스, 제품 매뉴얼 등 참조 |
| 작동 원리 | 사용자 질문 → 검색 → 관련 문서 추출 → 프롬프트 확장 → 답변 생성 | "참고: 연차는 연 15일…" 문서 내용 포함하여 답변 |
| 지식 기반 검색 | 업로드한 파일 내용에서 바로 검색·참조 | PDF 업로드 후 요약, FAQ 문서 기반 고객 응대 |
| 벡터 데이터베이스 | 문서를 벡터로 변환해 유사도 검색 | Pinecone, FAISS, Weaviate 등 활용 |
| vs 일반 프롬프트 | 일반: 모델 사전 지식만 사용 / RAG: 실시간 외부 정보 활용 | "연차 규정 알려줘" → RAG: 실제 문서 기반, 일반: 추론 기반 |
| 주의할 점 | 오래된 문서, 과도한 검색 범위, 문서 혼선 등 오류 가능 | 버전 관리, 자르기 전략 사용 |
| 그라운딩 (Grounding) | 외부 정보로 생성 결과의 신뢰도 확보 | 웹검색, DB검색, 지식 검색 모두 그라운딩에 해당 |

## 요약

- RAG는 외부 문서나 데이터베이스에서 정보를 검색해 프롬프트에 보강함으로써 환각을 줄이는 전략입니다.
- 지식 기반 검색과 벡터 데이터베이스 방식이 있으며, 검색 결과를 요약·정리해 사용합니다.
- 그라운딩을 통해 생성 결과의 신뢰도를 높이고, 최신 정보나 사내 지식 활용이 가능합니다.

## 생각해보기

- 일반 프롬프트와 RAG의 가장 큰 차이는 무엇인가요?
- RAG를 사용할 때 환각을 줄이는 원리는 무엇인가요?
- 지식 기반 검색과 RAG의 장단점은 무엇인가요?
- 오래된 문서나 검색 오류를 방지하기 위해 어떤 전략이 필요할까요?
- RAG가 실무에서 특히 유용한 상황은 어떤 경우일까요?

---

[개인화 메모리](08-Memory.md) ← 이전 / 다음 → [코드 기반 프롬프트](10-Code-based.md)