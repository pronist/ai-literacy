# 프롬프트 테스트

> AI에게 같은 요청을 했는데도 결과가 조금씩 다를 때가 있죠? 이럴 때 어떤 표현이 더 원하는 결과를 잘 만들어내는지 확인해보는 작업이 바로 프롬프트 테스트입니다.

## 개요

- 멀티턴, CoT, Prompt Chaining 등으로 설계한 프롬프트가 잘 작동하는지 확인하는 방법입니다.
- 좋은 프롬프트는 "작동하는 프롬프트"가 아니라 "항상 정확하고, 원하는 방식으로 작동하는 프롬프트" 입니다. 
- 프롬프트도 코드처럼 테스트하고, 기준을 정해 반복 검증해야 합니다.
- 프롬프트 엔지니어링의 본질인 '예상 가능한 응답결과'를 얻어내기 위한 프롬프트를 선정하기 위한 것입니다. 
- 같은 프롬프트를 입력했을 때 항상 논리적으로 동일한 결과를 나타내는지 테스트합니다.
- 응답을 사람이 테스트하는 것도 가능하지만, '자기 평가'할 수 있으므로 단일 또는 멀티 에이전트 시스템에서 만든 결과물을 테스트하는 것도 가능합니다.

## 테스트가 필요한 경우

- [ ] 같은 프롬프트인데 결과가 들쭉날쭉하다
- [ ] 결과가 원하는 형식을 잘 안 지킨다
- [ ] 특정 정보가 자꾸 누락되거나 환각이 발생한다
- [ ] 여러 버전 중 어떤 프롬프트가 더 나은지 고민 중이다
- [ ] 팀원과 프롬프트를 공유하고 유지보수할 계획이다
- [ ] 에지 케이스(오타, 짧은 입력)에서 이상 반응이 나온다

## 평가 기준

| 항목 | 설명 |
| --- | --- |
| 일관성 | 같은 입력에 대해 항상 유사한 출력이 나오는가? |
| 정확성 | 요구한 정보를 정확히 포함하고 있는가? |
| 형식 준수 | 출력이 지정한 형식(예: JSON, 표, 마크다운 등)을 따르는가? |
| 지시 이행률 | 프롬프트에 명시된 지시를 얼마나 충실히 따랐는가? |
| 에지 케이스 대응력 | 오타, 짧은 입력, 모호한 상황에서도 적절히 반응하는가? |

## 기초

> 사람이 평가하는 경우 주관적으로 암묵적인 느낌에 의해 통과를 결정할 수도 있으나, 프롬프트의 버전을 관리하고 유지보수을 하기위한 측면에서는 통과기준을 명확히 하는 것이 협업하기 좋습니다.

> 프롬프트를 작성하고 실행했을 때, 원하는 결과가 나오지 않는다고 해서 모델이 멍청하다고 탓할 것이 아니라, 나의 프롬프트가 잘못된 것이 아닐까? 하고 돌아보는 과정이 필요합니다.

### 수동 평가

- 프롬프트를 입력하고 원하는 결과가 나올 때까지 실패 사례를 수집하고, 원인을 분석하면서 최대한 많이 시도하여 '직접' 프롬프트를 수정 및 개선합니다. 
- '프롬프트 디버깅(Prompt Debugging)'이라고도 하며 테스트한 프롬프트와 응답을 문서화하고 다른 버전의 프롬프트와 비교하여 통과 기준을 충족하는 더 나은 프롬프트를 선택합니다.

```
- [ ] 같은 프롬프트에 대해 유사한 응답이 반복적으로 생성되는가? (일관성)
- [ ] 출력이 JSON, 표 등 지정된 형식으로 정확히 나오는가? (형식 준수)
- [ ] 요청한 정보가 모두 포함되었는가? (정확성)
- [ ] "기억해줘" 또는 "요약해줘" 요청 시 대응이 적절한가? (지시 이행률)
- [ ] 입력 문장에 오타/모호성이 있어도 적절히 반응하는가? (에지 케이스)
```

### 자동화 테스트

- 자기 평가, 코드 기반 프롬프트와 같은 기법을 사용하여 응답을 주어진 기준에 따라 테스트를 자동화할 수 있습니다. 
- 프롬프트가 개인이 아닌 '팀' 또는 전사적 차원에서 관리되는 경우 프롬프트의 개수가 너무 많아질 수 있으므로 프롬프트를 테스트하는 과정을 위임할 수 있습니다.

### 테스트 결과 템플릿

| 테스트 ID | 프롬프트 버전 | 테스트 시나리오 | 입력 예시 | 기대 출력 | 실제 출력 | 평가 | 코멘트 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| T-001 | v0.1 | 정상 케이스 | 고객 메일 전문 | 요약 3줄 + 감정 1줄 | 요약 2줄, 감정 없음 | × | 감정 추론 실패 |
| T-002 | v0.1 | 긴 텍스트 (2000자) | 대화 로그 | 5개 질문 생성 | 5개 생성됨 | ○ | 정상 처리됨 |
| T-003 | v0.2 | 오타 포함 | "고갓님 문의입니다" | 유사 대응 | 질문 비정상 | △ | LLM 오타 인식 부족 |
| T-004 | v0.2 | 형식 테스트 | JSON 출력 요구 | 키-값 쌍 출력 | 마크다운 표 출력 | × | 형식 불일치 |

## A/B 테스트

- 테스트 대상 프롬프트를 각기 다른 A, B버전으로 나누고 두 응답을 테스트하여 통과 기준에 부합하거나 더 나은 프롬프트가 무엇인지를 테스트하는 방식입니다.
- 두 버전의 통계적 지표를 확인하거나 사용자의 반응을 살펴보는 등의 결과를 토대로 최종 버전을 결정합니다. 

### 예시

```
- 당신은 마케팅 콘텐츠 전문가입니다.

# 지시

[A], [B] 프롬프트의 결과를 [기준]에 따라 더 적합한 문장을 선택해주세요.

A="생성형 AI 강의를 소개하는 한 문장 광고 문구를 작성해주세요."
B="[예시]를 참고하여 비전문가를 위한 온라인 생성형 AI 강의를 소개하는 한 문장 광고 문구를 작성해주세요. 예시= 당신의 시간을 아껴주는 AI 강의!"

# 기준

1. 광고 문구로서 매력적인가?
2. 문장 수가 한 문장으로 지켜졌는가?
3. 강의 주제를 잘 반영했는가?
```

### 과정

```
┌───────────────────────────────┐
│       [프롬프트 후보 생성]     
│             A, B
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│        [테스트 기준 정의]       
│ - 일관성 / 정확성 / 형식 준수 등 
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│            [테스트]     
│ - 수동: 사람이 3~5회 반복 테스트  
│ - 자동: Self-Eval, A/B 비교 등 
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│      [결과 문서화 및 평가]     
│ 예: A은 형식 불일치 → 보류    
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│       [버전 관리 및 선택]      
│ - B 채택 및 저장         
│ - PromptLayer, Git 등 활용 
└───────────────────────────────┘
```

### 테스트 결과 템플릿

| 테스트 항목 | 평가 기준 | 프롬프트 A | 프롬프트 B | 평가 결과 | 코멘트 |
| --- | --- | --- | --- | --- | --- |
| 마케팅 문구 작성 | 표현 매력도 | AI 강의에 오신 걸 환영합니다! | 당신의 시간을 아껴주는 AI 강의! | B 우세 | 문장이 더 강렬하고 CTA 효과 높음 |
| 출력 형식 일치 | JSON 구조 | 형식 누락 | 완전한 JSON 출력 | B 우세 | 자동화에 적합 |
| 응답 길이 제어 | 200자 이내 | 280자 | 180자 | B 우세 | A는 길이 초과 |
| 청중 적합성 | 초등 고학년 대상 | 용어 어려움 | 쉬운 단어 사용 | B 우세 | A는 추상적 용어 사용 |

## PromptOps

- 프롬프트의 기획 → 작성 → 테스트 → 배포 → 모니터링 → 개선/보완까지의 전 과정을 관리하는 것을 의미합니다.

> 코드 리뷰처럼 프롬프트 리뷰를 하세요. 왜 이 구조로 만들었는지, 실패 사례는 무엇인지 공유하면 팀 전체의 프롬프트 품질이 평균 이상이 됩니다. 팀원별로 "좋았던 프롬프트" 컬렉션을 만들어도 좋아요.

### 과정

```
┌───────────────────────────────┐
│        [프롬프트 작성]         
│ - 역할 / 지시 / 예시 구성     
│ - 출력 형식 및 조건 명시       
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│            [테스트]             
│ - 수동: 사람이 직접 평가       
│ - 자동: Self-Eval, A/B 테스트  
│ - 기준: 일관성 / 정확성 / 형식 준수
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│             [배포]               
│ - 운영 환경에 반영            
│ - 버전명(v0.1 등) 명시        
│ - 협업 시 공유 또는 승인      
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│           [모니터링]              
│ - 응답 결과 수집 / 로그 확인  
│ - 이슈 및 실패 케이스 기록    
└───────────────────────────────┘
                ↓
┌───────────────────────────────┐
│             [개선]               
│ - 실패 원인 분석             
│ - 수정 및 리팩토링           
│ - 새로운 버전(v0.2 등) 생성  
└───────────────────────────────┘
                ↓
      (다시 '작성' 단계로 순환)
```

### 역할 분담

| 단계 | 설명 | 책임 주체 |
| --- | --- | --- |
| 기획 | 프롬프트 목적 정의, 역할 설정 | PM, 실무 담당자 |
| 작성 | 프롬프트 기본 요소 포함하여 설계 | 프롬프트 엔지니어 |
| 테스트 | 일관성, 정확성, 형식 등 기준 검증 | QA, 실무자 |
| 배포 | 프로덕션 반영 및 사용 환경 연결 | 운영자, 개발자 |
| 모니터링 | 응답 로그 수집, 이슈 기록 | 운영자 |
| 개선 | 실패 사례 분석, 업데이트 | 전담 팀 또는 프롬프트 관리자 |

### 버전

- 프롬프트는 처음엔 '이메일 써줘' 같은 요청에서 시작하지만, 시간이 지날수록 역할, 조건, 출력 형식까지 요구하는 복잡한 로직이 됩니다. 
- 만약 프롬프트를 개인이 아닌 팀단위로 관리하는 경우 버전관리가 중요하기 때문에 소프트웨어에서 버전을 관리하듯이 v0.1, v0.2와 같이 버전을 명시할 수 있습니다.
- 버전을 관리하기 위해 구글 시트, 노션 등을 사용할 수 있지만, Git처럼 전용 버전관리 도구를 사용할 수도 있습니다. 

> Git: 소프트웨어 개발에서 소스코드의 변경이력을 추적하는데 사용되는 도구로, 프롬프트를 대상으로 변경 사항과 테스트 결과를 추적할 수 있도록 만들어주고, 육하원칙에 따라 누가, 언제, 어디서, 무엇을, 어떻게, 왜 변경했는지를 보여줍니다.

#### 버전 관리 템플릿

| 항목 | 설명 |
| --- | --- |
| 버전명 | 관리 가능한 식별자 |
| 작성자 | 최초 작성자 |
| 작성일 | 문서 최초 등록일 |
| 최근 수정일 | 마지막 변경 날짜 |
| 변경 로그 | 어떤 변경이 있었는지 요약 |
| 테스트 결과 | 테스트 통과 여부 및 항목별 평가 |

### 문서

| 속성명 | 설명 |
| --- | --- |
| 이름 | 프롬프트 명칭 (예: `faq-extractor-v0.2`) |
| 태스크 유형 | 요약, 분류, 생성, 질의응답 등 |
| 작성자 | 최초 작성자 |
| 역할| 예: "고객지원 담당자" |
| 목적 | 어떤 작업에 사용되는지 한 줄 설명 |
| 지시문 | 실제 입력 프롬프트 |
| 출력 형식 | JSON / 표 / 마크다운 / 텍스트 등 |
| 사용 모델 | GPT-4 / Claude / Gemini 등 |
| 평가 상태 | 미테스트 / 통과 / 수정 필요 |
| 버전 | 예: v0.1, v1.2-kor 등 |
| 등록일 | 최초 작성일 |
| 수정일 | 최근 수정일 |
| 상태 | 초안 / 운영중 / 보류 / 폐기 |

### 도구

- ChatGPT → 아이디어 탐색 및 시나리오 작성
    - 비전문가에게 적합하나, 로그 관리 및 버전 비교와 같은 기능이 없습니다. 
    - [샘플링 전략](25-Sampling.md)을 실험해볼 수도 없다는 단점이 있습니다.
- [OpenAI Playground](https://platform.openai.com/playground) → 매개변수 조정 및 응답 튜닝
    - 파라미터를 설정하고 응답결과를 실험해볼 수 있는 조금 더 전문가에 가까운 도구입니다. 
    - 입/출력 세션을 저장하고 비교할 수 있으며 프롬프트를 코드 형태로 쉽게 전환이 가능합니다. 
    - 프롬프트 엔지니어들이 프롬프트를 테스트할 때 사용하기도 합니다. 
- [PromptLayer](https://www.promptlayer.com) → 실험 추적 및 버전 관리
    - 프롬프트 실행기록을 저장하고 분석할 수 있는 로그 기반 도구이며 버전 관리 및 프롬프트 실험 추적에 유용합니다. 
    - 프롬프트 결과를 저장하고 시각화 할 수 있어 버전 관리에 유용합니다. 
    - 실행 환경 설정이 필요하여 기술적 장벽이 있을 수 있고 반복 테스트 및 분석에 최적화되어 있습니다. 
    - A/B 테스트 및 팀 단위 프롬프트 관리 및 협업에 유용합니다. 

| 항목 | ChatGPT | Playground | PromptLayer |
| --- | --- | --- | --- |
| 사용자 대상 | 비전문가 | 개발자 | 개발자 |
| 대화 흐름 지원 | O | △ (단발형) | X |
| 파라미터 조정 | 제한적 | 세밀하게 가능 | API 연동 시 가능 |
| 테스트 반복성 | 낮음 | 보통 | 높음 |
| 결과 기록 | 수동 복사 | 세션 저장 가능 | 자동 로그 저장 |
| 협업 기능 | 없음 | 없음 | 버전 관리 및 공유 가능 |
| 학습/강의 적합도 | 매우 높음 | 중간 | 낮음(고급) |

> 전용 도구 도입이 어렵다면 Google Sheet + 프롬프트 명세서 + 간단한 평가 기준부터 시작해도 충분합니다.

## 모델 선택

- 프롬프트를 아무리 잘 설계해도, 모델이 그 작업에 적합하지 않으면 원하는 결과를 얻기 어렵습니다.  
- 모델마다 잘하는 일이 다르기 때문에, 테스트할 때는 모델 선택도 중요한 과정입니다.  
- 대표적으로 모델은 GPT-4o와 같은 범용 모델과 o3와 같은 추론 특화 모델로 나눌 수 있습니다.

### 범용 vs 추론

- 범용 모델은 다양한 주제에 유연하게 대응하고, 자연스러운 대화와 창작에 강합니다.
- 추론 모델은 정확한 문제 풀이, 수학 계산, 논리적 질의응답에 유리합니다.

| 항목 | 범용(General-purpose) | 추론(Reasoning) |
| --- | --- | --- |
| 목적 | 대화, 창작, 요약, 번역, 코드, 멀티모달 | 문제 풀이, 논리 추론, 수학 계산, Q&A 정확도 |
| 모델 성향 | 설명 친절, 말 잘함, 창의적 표현 | 정답 지향, 논리적 사고, 설명은 짧을 수 있음 |
| 비유 | "말 잘하는 멀티플레이어" | "생각 잘하는 문제 해결사" |
| 강점 | 다양한 주제 대응, 멀티모달 지원 | 고난도 추론, 수학·퍼즐 문제에 강함 |
| 약점 | 논리적 추론에서 실수 가능 | 창의성 부족, 대화 자연스러움 약함 |
| [RLHF](19-Learning.md) | 있음 (자연스러운 대화와 품질 개선) | 있음 (추론 정확도 강화 중심) |
| 추천 질문 예시 | "이 회사의 장점은 뭐야?", "이 사진 설명해줘" | "15와 20의 최대공약수는?", "왜 이게 맞는 답이야?" |

## 정리

| 항목 | 설명 | 예시 |
| --- | --- | --- |
| 정의 | 프롬프트가 '항상 원하는 결과'를 잘 만드는지 확인하는 과정 | 같은 요청 → 결과가 일관되고 정확한가? |
| 필요성 | 결과가 들쭉날쭉, 정보 누락, 환각, 형식 오류, 에지 케이스 발생 시 검증 | FAQ 요약, JSON 출력 실패, 오타 대응 확인 등 |
| 평가 기준 | 일관성, 정확성, 형식 준수, 지시 이행률, 에지 케이스 대응력 | "항상 5개 항목이 출력되는가?" |
| 테스트 방법 | 수동 평가 / 자동화 평가 / A/B 테스트 / PromptOps | 사람이 직접 체크, Self-Eval, PromptLayer 활용 등 |
| 자동화 | 자기 평가(Self-Eval), [함수 기반 평가](10-Code-based.md)  | "output에 '서울' 포함? → 통과/실패" |
| 버전 관리 | 테스트 결과를 기록하고 버전별로 관리 | v0.1 → 오타 대응 부족 → v0.2 수정 후 재테스트 |
| 주요 도구 | ChatGPT, Playground, PromptLayer | 구글 시트로도 간단히 시작 가능 |

## 요약

- 프롬프트 테스트는 '작동하는 것'이 아닌 '항상 잘 작동하는 것'을 검증하는 과정입니다.
- 일관성, 정확성, 형식 준수 등 명확한 기준으로 수동/자동 테스트를 수행해야 합니다.
- A/B 테스트와 버전 관리로 실패 사례를 개선하고 품질을 유지할 수 있습니다.

## 생각해보기

- 프롬프트 테스트를 하지 않고 실무에 바로 사용하는 경우 어떤 위험이 있을까요?
- 수동 테스트와 자동화 테스트는 각각 어떤 상황에서 유리할까요?
- 일관성(Consistency)과 정확성(Accuracy)은 어떤 점에서 다르고 왜 둘 다 필요할까요?
- A/B 테스트 방식은 어떤 기준으로 '더 나은 프롬프트'를 판단하나요?
- 팀 단위로 프롬프트를 관리할 때 버전 관리를 해야 하는 이유는 무엇인가요?
